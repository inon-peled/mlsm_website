<div class="publications" id="publications"></div>
<script type="text/javascript" src="pubs.js"></script>
<script type="text/javascript">
    function getAuthorsString(authors) {
        function toStylizedString(author) {
            const surname = author.split(" ").slice(-1);
            const initials = author.split(" ").slice(0, -1).map(function (s) {
                return s[0].toUpperCase() + '.';
            }).join(" ");
            return surname + ", " + initials;
        }

        return typeof authors === 'string' ? authors : authors.map(toStylizedString).join(", ");
    }

    function onePubToHtml(pub) {
        function link(pub, linkKey, linkName) {
            if (pub.links[linkKey]) {
                return '<span class="pubLink"><a target="_blank" href="' +
                    pub.links[linkKey] + '"> [' + linkName + ']</a></span>';
            }
        }

        return '<span class="authors">' + getAuthorsString(pub['authors']) + '</span>\n' +
            '<span class="pubTitle">' + pub.title + '</span>\n' +
            link(pub, 'pdf', 'PDF') +
            link(pub, 'code', 'Code') +
            link(pub, 'data', 'Data') +
            '\n<span class="pubWhereAndWhen">in ' + pub.pub.where + ', ' + pub.pub.year + '</span>';
    }

    function groupByYear(pubs) {
        groups = {};
        for (var i = 0; i < pubs.length; i += 1) {
            var year = pubs[i].pub.year;
            if (year) {
                if (!(year in groups)) {
                    groups[year] = [];
                }
                groups[year].push(pubs[i])
            }
        }
        return groups;
    }

    function main(pubs) {
        var pubsDiv = document.getElementById("publications");
        var pubsGroupedByYear = groupByYear(pubs);
        var yearsInDescendingOrder = Object
            .keys(pubsGroupedByYear)
            .sort(function (a, b) {
                return b - a;
            });
        for (var i = 0; i < yearsInDescendingOrder.length; i += 1) {
            var year = yearsInDescendingOrder[i];
            var pubsOfYear = pubsGroupedByYear[year];
            pubsDiv.innerHTML += '<h1 class="headerYear">' + year + '</h1>\n<ul>\n';
            for (var j = 0; j < pubsOfYear.length; j += 1) {
                pubsDiv.innerHTML += '<li>\n' + onePubToHtml(pubsOfYear[j]) + '\n</li>\n';
            }
            pubsDiv.innerHTML += '</ul>\n' + '[su_divider top="yes" text="Go to top" style="default" divider_color="#990000" link_color="#990000" size="3" margin="15" class=""]\n';
        }
    }

    main(publications);
</script>
